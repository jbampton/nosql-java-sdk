<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) on Fri Nov 17 12:57:51 PST 2023 -->
<title>RateLimiter (Oracle NoSQL Database SDK for Java 5.4.14)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2023-11-17">
<meta name="description" content="declaration: package: oracle.nosql.driver, interface: RateLimiter">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<div class="about-language"><b>Oracle NoSQL Database</b><br><font size="-1"> Version 5.4.14 17-November-2023</font></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/RateLimiter.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">oracle.nosql.driver</a></div>
<h1 title="Interface RateLimiter" class="title">Interface RateLimiter</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">RateLimiter</span></div>
<div class="block">RateLimiter interface provides default methods that all rate limiters
 must implement.
 <p>
 In NoSQL Cloud, rate limiters are used internally in <a href="NoSQLHandle.html" title="interface in oracle.nosql.driver"><code>NoSQLHandle</code></a>
 operations when enabled using NoSQLHandleConfig#setRateLimitingEnabled}.
 <p>
 <b>Typical usage:</b>
 The simplest use of the rate limiter is to consume a number of units,
 blocking until they are successfully consumed:
 <pre>
    int delayMs = rateLimiter.consumeUnits(units);
    // delayMs indicates how long the consume delayed
 </pre>
 <p>
 To poll a limiter to see if it is currently over the limit:
 <pre>
    if (rateLimiter.tryConsumeUnits(0)) {
        // limiter is below its limit
    }
 </pre>
 <p>
 To attempt to consume units, only if they can be immediately consumed
 without waiting:
 <pre>
    if (ratelimiter.tryConsumeUnits(units)) {
        // successful consume
    } else {
        // could not consume units without waiting
    }
 </pre>
 <p>
 Usages that involve waiting with timeouts:
 <p>
 In cases where the number of units an operation will consume is already
 known before the operation, a simple one-shot method can be used:
 <pre>
    long units = (known units the operation will use)
    try {
        boolean alwaysConsume=false; // don't consume if we time out
        int delayMs = rateLimiter.consumeUnitsWithTimeout(units,
                      timeoutMs, alwaysConsume);
        // we waited delayMs for the units to be consumed, and the
        // consume was successful
        ...do operation...
    } catch (TimeoutException e) {
        // we could not do the operation within the given timeframe.
        ...skip operation...
    }
 </pre>
 <p>
 In cases where the number of units an operation will consume is not
 known before the operation, typically two rate limiter calls would be
 used: one to wait till the limiter is below it limit, and a second
 to update the limiter with used units:
 <pre>
    // wait until we're under the limit
    try {
        // note here we don't consume units if we time out
        int delayMs = rateLimiter.consumeUnitsWithTimeout(0,
                      timeoutMs, false);
    } catch (TimeoutException e) {
        // we could not go below the limit within the given timeframe.
        ...skip operation...
    }
    // we waited delayMs to be under the limit, and were successful
    long units = ...do operation, get number of units used...
    // update rate limiter with consumed units. Next operation on this
    // limiter may delay due to it being over its limit.
    rateLimiter.consumeUnits(units);
 </pre>
 <p>
 Alternately, the operation could be always performed, and then the
 limiter could try to wait for the units to be consumed:
 <pre>
    long units = ...do operation, get number of units used...
    try {
        boolean alwaysConsume=true; // consume, even if we time out
        int delayMs = rateLimiter.consumeUnitsWithTimeout(units,
                      timeoutMs, alwaysConsume);
        // we waited delayMs for the units to be consumed, and the
        // consume was successful
    } catch (TimeoutException e) {
        // the rate limiter could not consume the units and go
        // below the limit in the given timeframe. Units are
        // consumed anyway, and the next call to this limiter
        // will likely delay
    }
 </pre>
 <p>
 <b>Limiter duration</b>:
 Implementing rate limiters should support a configurable "duration".
 This is sometimes referred to as a "burst mode", or a "window time",
 or "burst duration".
 This will allow consumes of units that were not consumed in the recent
 past. For example, if a limiter allows for 100 units per second, and is
 not used for 5 seconds, it should allow an immediate consume of 500
 units with no delay upon a consume call, assuming that the limiter's
 duration is set to at least 5 seconds.
 The maximum length of time for this duration should be configurable.
 In all cases a limiter should set a reasonable minimum duration, such
 that a call to <pre>tryConsumeUnits(1)</pre> has a chance of succeeding.
 It is up to the limiter implementation to determine if units from the past
 before the limiter was created or reset are available for use.
 If a limiter implemetation does not allow setting a duration, it must throw
 an UnsupportedOperationException when its setDuration() method is called.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button><button id="method-summary-table-tab5" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab5', 3)" class="table-tab">Default Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>int</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#consumeUnits(long)" class="member-name-link">consumeUnits</a><wbr>(long&nbsp;units)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Consumes a number of units, blocking until the units are available.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#consumeUnitsUnconditionally(long)" class="member-name-link">consumeUnitsUnconditionally</a><wbr>(long&nbsp;units)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Consumes units without checking or waiting.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>int</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#consumeUnitsWithTimeout(long,int,boolean)" class="member-name-link">consumeUnitsWithTimeout</a><wbr>(long&nbsp;units,
 int&nbsp;timeoutMs,
 boolean&nbsp;alwaysConsume)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Attempts to consume a number of units, blocking until the units are
 available or the specified timeout expires.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>double</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getCurrentRate()" class="member-name-link">getCurrentRate</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Returns the current rate as a percentage of current limit.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code>default double</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code><a href="#getDuration()" class="member-name-link">getDuration</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5">
<div class="block">Returns the duration configured for this rate limiter instance</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>double</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getLimitPerSecond()" class="member-name-link">getLimitPerSecond</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Returns the number of units configured for this rate limiter instance</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#reset()" class="member-name-link">reset</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Resets the rate limiter as if it was newly constructed.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#setCurrentRate(double)" class="member-name-link">setCurrentRate</a><wbr>(double&nbsp;rateToSet)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Sets the current rate as a percentage of current limit.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code>default void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5"><code><a href="#setDuration(double)" class="member-name-link">setDuration</a><wbr>(double&nbsp;durationSecs)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab5">
<div class="block">Sets the duration for this rate limiter instance.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#setLimitPerSecond(double)" class="member-name-link">setLimitPerSecond</a><wbr>(double&nbsp;rateLimitPerSecond)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Sets a new limit (units per second) on the limiter.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#tryConsumeUnits(long)" class="member-name-link">tryConsumeUnits</a><wbr>(long&nbsp;units)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Consumes the specified number of units if they can be returned
 immediately without waiting.</div>
</div>
</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="consumeUnits(long)">
<h3>consumeUnits</h3>
<div class="member-signature"><span class="return-type">int</span>&nbsp;<span class="element-name">consumeUnits</span><wbr><span class="parameters">(long&nbsp;units)</span></div>
<div class="block">Consumes a number of units, blocking until the units are available.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>units</code> - the number of units to consume. This can be a negative
        value to "give back" units.</dd>
<dt>Returns:</dt>
<dd>the amount of time blocked in milliseconds. If not blocked,
         0 is returned.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="tryConsumeUnits(long)">
<h3>tryConsumeUnits</h3>
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">tryConsumeUnits</span><wbr><span class="parameters">(long&nbsp;units)</span></div>
<div class="block">Consumes the specified number of units if they can be returned
 immediately without waiting.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>units</code> - The number of units to consume. Pass zero to poll if the
        limiter is currently over its limit. Pass negative values to
        "give back" units (same as calling <a href="#consumeUnits(long)"><code>consumeUnits(long)</code></a>
        with a negative value).</dd>
<dt>Returns:</dt>
<dd>true if the units were consumed, false if they were not
         immediately available. If units was zero, true means the
         limiter is currently below its limit.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="consumeUnitsWithTimeout(long,int,boolean)">
<h3>consumeUnitsWithTimeout</h3>
<div class="member-signature"><span class="return-type">int</span>&nbsp;<span class="element-name">consumeUnitsWithTimeout</span><wbr><span class="parameters">(long&nbsp;units,
 int&nbsp;timeoutMs,
 boolean&nbsp;alwaysConsume)</span>
                     throws <span class="exceptions"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeoutException.html" title="class or interface in java.util.concurrent" class="external-link">TimeoutException</a>,
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></span></div>
<div class="block">Attempts to consume a number of units, blocking until the units are
 available or the specified timeout expires.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>units</code> - the number of units to consume. This can be a negative
        value to "give back" units.</dd>
<dd><code>timeoutMs</code> - the timeout in milliseconds. Pass 0 to block
        indefinitely. To poll if the limiter is
        currently over its limit, use <a href="#tryConsumeUnits(long)"><code>tryConsumeUnits(long)</code></a> instead.</dd>
<dd><code>alwaysConsume</code> - if true, consume units even on timeout</dd>
<dt>Returns:</dt>
<dd>the amount of time blocked in milliseconds. If not blocked,
         0 is returned.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/TimeoutException.html" title="class or interface in java.util.concurrent" class="external-link">TimeoutException</a></code> - if the timeout expires before the units can
         be acquired by the limiter.</dd>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if the timeout is negative</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getLimitPerSecond()">
<h3>getLimitPerSecond</h3>
<div class="member-signature"><span class="return-type">double</span>&nbsp;<span class="element-name">getLimitPerSecond</span>()</div>
<div class="block">Returns the number of units configured for this rate limiter instance</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the max number of units per second this limiter allows</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setDuration(double)">
<h3>setDuration</h3>
<div class="member-signature"><span class="modifiers">default</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setDuration</span><wbr><span class="parameters">(double&nbsp;durationSecs)</span></div>
<div class="block">Sets the duration for this rate limiter instance.
 <p>
 The duration specifies how far back in time the limiter will
 go to consume previously unused units.
 <p>
 For example, if a limiter had a limit of 1000 units and a
 duration of 5 seconds, and had no units consumed for at least
 5 seconds, a call to<pre>tryConsumeUnits(5000)</pre> will succeed
 immediately with no waiting.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>durationSecs</code> - the duration in seconds</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html" title="class or interface in java.lang" class="external-link">UnsupportedOperationException</a></code> - if duration is not
 supported by this limiter.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getDuration()">
<h3>getDuration</h3>
<div class="member-signature"><span class="modifiers">default</span>&nbsp;<span class="return-type">double</span>&nbsp;<span class="element-name">getDuration</span>()</div>
<div class="block">Returns the duration configured for this rate limiter instance</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the duration in seconds</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html" title="class or interface in java.lang" class="external-link">UnsupportedOperationException</a></code> - if duration is not
 supported by this limiter.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="reset()">
<h3>reset</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">reset</span>()</div>
<div class="block">Resets the rate limiter as if it was newly constructed.
 <p>
 Allows reuse.</div>
</section>
</li>
<li>
<section class="detail" id="setLimitPerSecond(double)">
<h3>setLimitPerSecond</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">setLimitPerSecond</span><wbr><span class="parameters">(double&nbsp;rateLimitPerSecond)</span></div>
<div class="block">Sets a new limit (units per second) on the limiter.
 <p>
 Note that implementing rate limiters should fully support non-integer
 (double) values internally, to avoid issues when the limits are set
 very low.
 Changing the limit may lead to unexpected spiky behavior, and may
 affect other threads currently operating on the same limiter instance.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>rateLimitPerSecond</code> - the new number of units to allow</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="consumeUnitsUnconditionally(long)">
<h3>consumeUnitsUnconditionally</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">consumeUnitsUnconditionally</span><wbr><span class="parameters">(long&nbsp;units)</span></div>
<div class="block">Consumes units without checking or waiting.
 the internal amount of units consumed will be updated by the given
 amount, regardless of its current over/under limit state.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>units</code> - the number of units to consume (may be negative to
        give back units)</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getCurrentRate()">
<h3>getCurrentRate</h3>
<div class="member-signature"><span class="return-type">double</span>&nbsp;<span class="element-name">getCurrentRate</span>()</div>
<div class="block">Returns the current rate as a percentage of current limit.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the rate as of this instant in time.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setCurrentRate(double)">
<h3>setCurrentRate</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">setCurrentRate</span><wbr><span class="parameters">(double&nbsp;rateToSet)</span></div>
<div class="block">Sets the current rate as a percentage of current limit.
 <p>
 This modifies the internal limiter values; it does not modify
 the rate limit.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>rateToSet</code> - percentage to set the current rate to. This may
        be greater than 100.0 to set the limiter to "over its limit".</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><font size=1>Copyright (c) 2011, 2023 Oracle and/or its affiliates. All rights reserved.</font></small></p>
</footer>
</div>
</div>
</body>
</html>
